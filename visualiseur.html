<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Visualiseur de Données</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background-color: #f4f4f4; }
        header { background-color: #2c3e50; color: white; padding: 15px; }
        .container { max-width: 1200px; margin: 20px auto; padding: 20px; background: white; border-radius: 5px; }
        
        /* Style du Tableau */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #2c3e50; color: white; }
        tr:nth-child(even) { background-color: #f2f2f2; }

        /* Bouton Télécharger */
        .btn-download {
            background-color: #27ae60;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            float: right;
            font-weight: bold;
        }
        .btn-download:hover { background-color: #219150; }
        .meta-info { background: #e8f6f3; padding: 15px; border-radius: 5px; margin-bottom: 20px; border-left: 5px solid #27ae60; }
    </style>
</head>
<body>

    <header>
        <a href="index.html" style="color:white; text-decoration:none;">&larr; Retour à l'accueil</a>
        <span style="float:right">Mon Site Data</span>
    </header>

    <div class="container">
        <div style="overflow: hidden; margin-bottom: 20px;">
            <h1 id="dataset-title" style="float:left; margin:0;">Chargement...</h1>
            <a id="download-link" href="#" class="btn-download" download>Télécharger le CSV</a>
        </div>

        <div class="meta-info">
            <p><strong>Source :</strong> <span id="dataset-source">Kaggle Open Data</span></p>
            <p id="dataset-desc">Description du dataset en cours de chargement...</p>
        </div>

        <div id="table-container" style="overflow-x:auto;">
            </div>
    </div>

    <script>
        // 1. Récupérer les paramètres de l'URL (ex: ?file=pib.csv&titre=PIB)
        const params = new URLSearchParams(window.location.search);
        const fileName = params.get('file');
        const title = params.get('titre');

        // 2. Mettre à jour le titre et le lien de téléchargement
        if (title) document.getElementById('dataset-title').innerText = title;
        if (fileName) {
            const filePath = 'Dataset/Economie/' + fileName;
            document.getElementById('download-link').href = filePath;
            
            // Description (Simulée pour l'instant)
            document.getElementById('dataset-desc').innerText = "Voici une visualisation complète des données contenues dans le fichier " + fileName + ".";

            // 3. Charger et Lire le fichier CSV
            fetch(filePath)
                .then(response => {
                    if (!response.ok) throw new Error("Fichier non trouvé");
                    return response.text();
                })
                .then(csvText => {
                    afficherTableau(csvText);
                })
                .catch(error => {
                    document.getElementById('table-container').innerHTML = `<p style="color:red">Erreur : Impossible de charger le dataset (${fileName}). Vérifiez qu'il est bien dans le dossier /data.</p>`;
                });
        } else {
            document.getElementById('table-container').innerHTML = "<p>Aucun dataset sélectionné.</p>";
        }

        // Fonction pour convertir le CSV en Tableau HTML
        function afficherTableau(csv) {
            const rows = csv.split('\n'); 
            let html = '<table>';
            
            rows.forEach((row, index) => {
                // Ignorer les lignes vides
                if (row.trim() === '') return;

                const cols = row.split(','); // ATTENTION: Si votre CSV utilise des points-virgules (;), changez ',' par ';' ici.
                
                html += '<tr>';
                cols.forEach(col => {
                    // Si c'est la première ligne (index 0), on met des <th> (titres), sinon des <td>
                    if (index === 0) {
                        html += `<th>${col.trim()}</th>`;
                    } else {
                        html += `<td>${col.trim()}</td>`;
                    }
                });
                html += '</tr>';
            });

            html += '</table>';
            document.getElementById('table-container').innerHTML = html;
        }
    </script>
</body>
</html>